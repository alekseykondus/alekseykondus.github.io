<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pages/analytics.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pages/analytics.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>function CreateElement(nameElement, idElement, innerText, parentId) {
     let element = document.createElement(nameElement);
     element.id = idElement;
     element.innerText = innerText;
     if (parentId == "body")
          document.body.appendChild(element);
     else
          document.getElementById(parentId).appendChild(element);
     return element;
}

/**
 * Fills in the employees statistics table based on the specified date range.
 *
 * @param {string} startDate - The start date of the period for which statistics are requested.
 * @param {string} endDate - The end date of the period for which statistics are requested.
 * @param {boolean} notOnLoad - Indicates whether the function is called during the initial page load or not.
 */
function FillInEmployeesTable(startDate = 0, endDate = 0, notOnLoad = 0) {

     if (startDate == 0 &amp;&amp; endDate == 0 &amp;&amp; notOnLoad == 0) { //при загрузке страницы
          CreateElement("h2", "h2-employees", "Таблиця статистики працівників", "main-products-container").classList.add("text-center");
          CreateElement("table", "employees-table", "", "main-products-container").classList.add("table", "table-striped", "table-hover");
          CreateElement("thead", "thead", "", "employees-table")
          CreateElement("tr", "tr1", "", "thead")
          CreateElement("td", "thead-tr1-td1", "Id співробітника", "tr1").classList.add("text-center", "w-15");
          CreateElement("td", "thead-tr1-td2", "Повне ім'я", "tr1");
          CreateElement("td", "thead-tr1-td3", "Кількість продажів", "tr1").classList.add("text-center");
          CreateElement("td", "thead-tr1-td4", "Загальна сума продажів", "tr1").classList.add("text-center");

          CreateElement("tbody", "tbody", "", "employees-table")
          fetch('/getEmployeesFromDB', {
               method: 'GET',
          })
               .then(res1 => res1.text())
               .then(res1 => {
                    let employees = JSON.parse(res1);

                    fetch('/getEmployeeStatisticsFromDB', {
                         method: 'GET',
                    })
                         .then(res2 => res2.text())
                         .then(res2 => {
                              let employeeStatisticsTable = JSON.parse(res2);
                              for (let i = 0; i &lt; employeeStatisticsTable.length; i++) {
                                   CreateElement("tr", "tr" + i + "-body", "", "tbody")
                                   CreateElement("td", "tr" + employeeStatisticsTable[i]['employeeId'] + "-td1", employeeStatisticsTable[i]['employeeId'], "tr" + i + "-body").classList.add("text-center");
                                   CreateElement("td", "tr" + employeeStatisticsTable[i]['employeeId'] + "-td2", employees[i]['fullName'], "tr" + i + "-body")
                                   CreateElement("td", "tr" + employeeStatisticsTable[i]['employeeId'] + "-td3", employeeStatisticsTable[i]['numberOfSales'], "tr" + i + "-body").classList.add("text-center");
                                   CreateElement("td", "tr" + employeeStatisticsTable[i]['employeeId'] + "-td4", employeeStatisticsTable[i]['salesAmount'].toLocaleString(), "tr" + i + "-body").classList.add("text-center");
                              }
                         });
               });
     }
     else if (notOnLoad == 0) { // при изменении даты в периоде
          //         CreateElement("tbody", "tbody", "", "employees-table")
          fetch('/getEmployeesFromDB', {
               method: 'GET',
          })
               .then(res1 => res1.text())
               .then(res1 => {
                    let employees = JSON.parse(res1);
                    for (let i = 0; i &lt; employees.length; i++) {
                         if (document.getElementById("tr" + employees[i]['employeeId'] + "-td3"))
                              document.getElementById("tr" + employees[i]['employeeId'] + "-td3").innerText = 0;
                         if (document.getElementById("tr" + employees[i]['employeeId'] + "-td4"))
                              document.getElementById("tr" + employees[i]['employeeId'] + "-td4").innerText = 0;
                    }

                    fetch('/getEmployeeStatisticsForThePeriodFromDB', {
                         method: 'POST',
                         body: JSON.stringify({
                              "startDate": startDate,
                              "endDate": endDate,
                         })
                    })
                         .then(res2 => res2.text())
                         .then(res2 => {
                              let employeeStatisticsTable = JSON.parse(res2);
                              for (let i = 0; i &lt; employeeStatisticsTable.length; i++) {
                                   document.getElementById("tr" + employeeStatisticsTable[i]['employeeId'] + "-td3").innerText = employeeStatisticsTable[i]['numberOfSales'];
                                   document.getElementById("tr" + employeeStatisticsTable[i]['employeeId'] + "-td4").innerText = parseInt(employeeStatisticsTable[i]['salesAmount']).toLocaleString();
                              }
                         });
               });
     }
     else if (notOnLoad == 1) { // при возврате на весь период
          fetch('/getEmployeesFromDB', {
               method: 'GET',
          })
               .then(res1 => res1.text())
               .then(res1 => {
                    let employees = JSON.parse(res1);
                    for (let i = 0; i &lt; employees.length; i++) {
                         document.getElementById("tr" + employees[i]['employeeId'] + "-td3").innerText = 0;
                         document.getElementById("tr" + employees[i]['employeeId'] + "-td4").innerText = 0;
                    }

                    fetch('/getEmployeeStatisticsFromDB', {
                         method: 'GET',
                    })
                         .then(res2 => res2.text())
                         .then(res2 => {
                              let employeeStatisticsTable = JSON.parse(res2);
                              for (let i = 0; i &lt; employees.length; i++) {
                                   document.getElementById("tr" + employeeStatisticsTable[i]['employeeId'] + "-td3").innerText = employeeStatisticsTable[i]['numberOfSales'];
                                   document.getElementById("tr" + employeeStatisticsTable[i]['employeeId'] + "-td4").innerText = employeeStatisticsTable[i]['salesAmount'].toLocaleString();
                              }
                         });
               });
     }
}

/**
 * Fills in the cars statistics table based on the specified date range.
 *
 * @param {string} startDate - The start date of the period for which statistics are requested.
 * @param {string} endDate - The end date of the period for which statistics are requested.
 * @param {boolean} notOnLoad - Indicates whether the function is called during the initial page load or not.
 */
function FillInCarsStatisticsTable(startDate = 0, endDate = 0, notOnLoad = 0) {
     if (startDate == 0 &amp;&amp; endDate == 0 &amp;&amp; notOnLoad == 0) { //при загрузке страницы
          CreateElement("h2", "h2-cars-statistics", "Таблиця статистики машин", "main-products-container").classList.add("text-center");
          CreateElement("table", "cars-statistics-table", "", "main-products-container").classList.add("table", "table-striped", "table-hover");
          CreateElement("thead", "cars-statistics-thead", "", "cars-statistics-table")
          CreateElement("tr", "cars-statistics-tr1", "", "cars-statistics-thead")
          CreateElement("td", "cars-statistics-thead-tr1-td1", "Id машини", "cars-statistics-tr1").classList.add("text-center");
          CreateElement("td", "cars-statistics-thead-tr1-td2", "Назва", "cars-statistics-tr1").classList.add("text-center");
          CreateElement("td", "cars-statistics-thead-tr1-td3", "Кількість проданих", "cars-statistics-tr1").classList.add("text-center");
          CreateElement("td", "cars-statistics-thead-tr1-td4", "Загальна сума продажів", "cars-statistics-tr1").classList.add("text-center");

          CreateElement("tbody", "cars-statistics-tbody", "", "cars-statistics-table")

          fetch('/getCarsFromDB', {
               method: 'GET',
          })
               .then(result1 => result1.text())
               .then(result1 => {
                    let carsTable = JSON.parse(result1);

                    fetch('/getCarsStatisticsFromDB', {
                         method: 'GET',
                    })
                         .then(result2 => result2.text())
                         .then(result2 => {
                              let carsStatisticsTable = JSON.parse(result2);
                              for (let i = 0; i &lt; carsStatisticsTable.length; i++) {
                                   CreateElement("tr", "cars-statistics-tr" + i + "-body", "", "cars-statistics-tbody")
                                   CreateElement("td", "cars-statistics-tr" + carsStatisticsTable[i]['carId'] + "-td1", carsStatisticsTable[i]['carId'], "cars-statistics-tr" + i + "-body").classList.add("text-center");
                                   CreateElement("td", "cars-statistics-tr" + carsStatisticsTable[i]['carId'] + "-td2", carsTable[carsStatisticsTable[i]['carId'] - 1]['name'], "cars-statistics-tr" + i + "-body")
                                   CreateElement("td", "cars-statistics-tr" + carsStatisticsTable[i]['carId'] + "-td3", carsStatisticsTable[i]['numberOfSales'], "cars-statistics-tr" + i + "-body").classList.add("text-center");
                                   CreateElement("td", "cars-statistics-tr" + carsStatisticsTable[i]['carId'] + "-td4", (carsStatisticsTable[i]['numberOfSales'] * carsTable[carsStatisticsTable[i]['carId'] - 1]['price']).toLocaleString(), "cars-statistics-tr" + i + "-body").classList.add("text-center");
                              }
                         });
               });

     }
     else if (notOnLoad == 0) { // при изменении даты в периоде

          fetch('/getCarsFromDB', {
               method: 'GET',
          })
               .then(result1 => result1.text())
               .then(result1 => {
                    let carsTable = JSON.parse(result1);
                    for (let i = 0; i &lt; carsTable.length; i++) {
                         if (document.getElementById("cars-statistics-tr" + carsTable[i]['carId'] + "-td3"))
                              document.getElementById("cars-statistics-tr" + carsTable[i]['carId'] + "-td3").innerText = 0;
                         if (document.getElementById("cars-statistics-tr" + carsTable[i]['carId'] + "-td4"))
                              document.getElementById("cars-statistics-tr" + carsTable[i]['carId'] + "-td4").innerText = 0;
                    }

                    fetch('/getCarsStatisticsForThePeriodFromDB', {
                         method: 'POST',
                         body: JSON.stringify({
                              "startDate": startDate,
                              "endDate": endDate,
                         })
                    })
                         .then(result2 => result2.text())
                         .then(result2 => {
                              let carsStatisticsTable = JSON.parse(result2);
                              for (let i = 0; i &lt; carsStatisticsTable.length; i++) {
                                   document.getElementById("cars-statistics-tr" + carsStatisticsTable[i]['carId'] + "-td3").innerText = carsStatisticsTable[i]['numberOfSales'];
                                   document.getElementById("cars-statistics-tr" + carsStatisticsTable[i]['carId'] + "-td4").innerText = (carsStatisticsTable[i]['numberOfSales'] * carsTable[carsStatisticsTable[i]['carId'] - 1]['price']).toLocaleString();
                              }
                         });
               });
     }
     else if (notOnLoad == 1) { // при возврате на весь период
          fetch('/getCarsFromDB', {
               method: 'GET',
          })
               .then(result1 => result1.text())
               .then(result1 => {
                    let carsTable = JSON.parse(result1);
                    fetch('/getCarsStatisticsFromDB', {
                         method: 'GET',
                    })
                         .then(result2 => result2.text())
                         .then(result2 => {
                              let carsStatisticsTable = JSON.parse(result2);
                              for (let i = 0; i &lt; carsStatisticsTable.length; i++) {
                                   document.getElementById("cars-statistics-tr" + carsStatisticsTable[i]['carId'] + "-td3").innerText = carsStatisticsTable[i]['numberOfSales'];
                                   document.getElementById("cars-statistics-tr" + carsStatisticsTable[i]['carId'] + "-td4").innerText = (carsStatisticsTable[i]['numberOfSales'] * carsTable[carsStatisticsTable[i]['carId'] - 1]['price']).toLocaleString();
                              }
                         });
               });
     }
}

/**
 * Fills in the clients statistics table based on the specified date range.
 *
 * @param {string} startDate - The start date of the period for which statistics are requested.
 * @param {string} endDate - The end date of the period for which statistics are requested.
 * @param {boolean} notOnLoad - Indicates whether the function is called during the initial page load or not.
 */
function FillInClientsStatisticsTable(startDate = 0, endDate = 0, notOnLoad = 0) {
     if (startDate == 0 &amp;&amp; endDate == 0 &amp;&amp; notOnLoad == 0) { //при загрузке страницы
          CreateElement("h2", "h2-clients", "Таблиця статистики клієнтів", "main-products-container").classList.add("text-center");
          CreateElement("table", "clients-table", "", "main-products-container").classList.add("table", "table-striped", "table-hover");
          CreateElement("thead", "clients-thead", "", "clients-table")
          CreateElement("tr", "clients-tr1", "", "clients-thead")
          CreateElement("td", "clients-thead-tr1-td1", "Id клієнта", "clients-tr1").classList.add("text-center", "w-15");
          CreateElement("td", "clients-thead-tr1-td2", "Повне ім'я", "clients-tr1");
          CreateElement("td", "clients-thead-tr1-td3", "Количество покупок", "clients-tr1").classList.add("text-center");
          CreateElement("td", "clients-thead-tr1-td4", "Витрачена сума", "clients-tr1").classList.add("text-center");

          CreateElement("tbody", "clients-tbody", "", "clients-table")
          fetch('/getClientsFromDB', {
               method: 'GET',
          })
               .then(result1 => result1.text())
               .then(result1 => {
                    let clients = JSON.parse(result1);
                    fetch('/getClientStatisticsFromDB', {
                         method: 'GET',
                    })
                         .then(result2 => result2.text())
                         .then(result2 => {
                              let clientStatisticsTable = JSON.parse(result2);
                              for (let i = 0; i &lt; clientStatisticsTable.length; i++) {
                                   CreateElement("tr", "clients-tr" + i + "-body", "", "clients-tbody")
                                   CreateElement("td", "clients-tr" + clientStatisticsTable[i]['clientId'] + "-td1", clients[i]['clientId'], "clients-tr" + i + "-body").classList.add("text-center");
                                   CreateElement("td", "clients-tr" + clientStatisticsTable[i]['clientId'] + "-td2", clients[i]['surname'] + ' ' + clients[i]['name'] + ' ' + clients[i]['patronymic'], "clients-tr" + i + "-body")
                                   CreateElement("td", "clients-tr" + clientStatisticsTable[i]['clientId'] + "-td3", clientStatisticsTable[i]['numberOfOrders'], "clients-tr" + i + "-body").classList.add("text-center");
                                   CreateElement("td", "clients-tr" + clientStatisticsTable[i]['clientId'] + "-td4", clientStatisticsTable[i]['ordersAmount'].toLocaleString(), "clients-tr" + i + "-body").classList.add("text-center");
                              }
                         });
               });
     }
     else if (notOnLoad == 0) { // при изменении даты в периоде
          fetch('/getClientsFromDB', {
               method: 'GET',
          })
               .then(result1 => result1.text())
               .then(result1 => {
                    let clients = JSON.parse(result1);
                    for (let i = 0; i &lt; clients.length; i++) {
                         if (document.getElementById("clients-tr" + clients[i]['clientId'] + "-td3"))
                              document.getElementById("clients-tr" + clients[i]['clientId'] + "-td3").innerText = 0;
                         if (document.getElementById("clients-tr" + clients[i]['clientId'] + "-td4"))
                              document.getElementById("clients-tr" + clients[i]['clientId'] + "-td4").innerText = 0;
                    }

                    fetch('/getClientStatisticsForThePeriodFromDB', {
                         method: 'POST',
                         body: JSON.stringify({
                              "startDate": startDate,
                              "endDate": endDate,
                         })
                    })
                         .then(result2 => result2.text())
                         .then(result2 => {
                              let clientStatisticsTable = JSON.parse(result2);
                              for (let i = 0; i &lt; clientStatisticsTable.length; i++) {
                                   document.getElementById("clients-tr" + clientStatisticsTable[i]['clientId'] + "-td3").innerText = clientStatisticsTable[i]['numberOfOrders'];
                                   document.getElementById("clients-tr" + clientStatisticsTable[i]['clientId'] + "-td4").innerText = parseInt(clientStatisticsTable[i]['ordersAmount']).toLocaleString();
                              }
                         });
               });
     }
     else if (notOnLoad == 1) { // при возврате на весь период
          fetch('/getClientsFromDB', {
               method: 'GET',
          })
               .then(result1 => result1.text())
               .then(result1 => {
                    let clients = JSON.parse(result1);
                    fetch('/getClientStatisticsFromDB', {
                         method: 'GET',
                    })
                         .then(result2 => result2.text())
                         .then(result2 => {
                              let clientStatisticsTable = JSON.parse(result2);
                              for (let i = 0; i &lt; clientStatisticsTable.length; i++) {
                                   document.getElementById("clients-tr" + clientStatisticsTable[i]['clientId'] + "-td3").innerText = clientStatisticsTable[i]['numberOfOrders'];
                                   document.getElementById("clients-tr" + clientStatisticsTable[i]['clientId'] + "-td4").innerText = parseInt(clientStatisticsTable[i]['ordersAmount']).toLocaleString();
                              }
                         });
               });
     }
}

/**
 * Fills in various tables with statistics based on the specified date range.
 * Calls three functions to fill in tables for employees, cars, and clients statistics.
 *
 * @param {string} startDate - The start date of the period for which statistics are requested.
 * @param {string} endDate - The end date of the period for which statistics are requested.
 * @param {boolean} notOnLoad - Indicates whether the function is called not during the initial page load.
 */
function FillInTables(startDate = 0, endDate = 0, notOnLoad = 0) {
     FillInEmployeesTable(startDate, endDate, notOnLoad);
     FillInCarsStatisticsTable(startDate, endDate, notOnLoad);
     FillInClientsStatisticsTable(startDate, endDate, notOnLoad);
}

/**
 * Handles the change event when the user specifies a custom date range.
 * Fetches and displays the total sales amount for the selected date range.
 * Calls the FillInTables function to update the UI with additional details for the specified period.
 */
function OnChangeDates() {
     var startDate = document.getElementById("start-date").value;
     var endDate = document.getElementById("end-date").value;

     fetch('/getSumOfAllOrdersForThePeriodFromDB', {
          method: 'POST',
          body: JSON.stringify({
               "startDate": startDate,
               "endDate": endDate,
          })
     })
          .then(result => result.text())
          .then(result => {
               document.getElementById("b-sales-amount").innerText = "Сума всіх продажів за період з " + startDate + " до " + endDate + " складає: " + result;
          });
     FillInTables(startDate, endDate);
}

/**
 * Handles the change event when the user selects a different period option.
 * Fetches and displays the total sales amount based on the selected period.
 * If "Весь період" (All period) is selected, it fetches the sum of all orders and updates the UI.
 * If "Певний період" (Specific period) is selected, it displays date input fields for the user to specify the start and end dates.
 * Calls the OnChangeDates function to update the UI based on the selected date range.
 */
function PeriodChanged() {
     if (document.getElementById("period").value === "Весь період") {
          fetch('/getSumOfAllOrdersFromDB', {
               method: 'GET',
          })
               .then(result => result.text())
               .then(result => {
                    if (document.getElementById("b-sales-amount") == undefined)
                         CreateElement("b", "b-sales-amount", "Сума всіх продажів за весь період " + result, "sales-amount").setAttribute('style', "font-size: 1.5em;");
                    else
                         document.getElementById("b-sales-amount").innerText = "Сума всіх продажів за весь період: " + result;
               });
          if (document.getElementById("start-date-div") == undefined)
               FillInTables();
          else {
               document.getElementById("start-date-div").remove();
               document.getElementById("end-date-div").remove();
               FillInTables(0, 0, 1);
          }
     }
     else if (document.getElementById("period").value === "Певний період") {
          if (!document.getElementById("start-date")) {
               CreateElement("div", "start-date-div", "", "periodStartEnd").classList.add("col-md-4", "mb-3");
               CreateElement("label", "start-date-label", "Початкова дата: ", "start-date-div").setAttribute('style', "font-size: 1.4em;");
               document.getElementById("start-date-label").classList.add("pt-3");
               CreateElement("input", "start-date", "", "start-date-div").classList.add("form-control");
               document.getElementById("start-date").setAttribute('type', "date");
               document.getElementById("start-date").value = "2023-11-01";
               document.getElementById("start-date").setAttribute('onchange', "OnChangeDates()");

               CreateElement("div", "end-date-div", "", "periodStartEnd").classList.add("col-md-4", "mb-3");
               CreateElement("label", "end-date-label", "Кінцева дата: ", "end-date-div").setAttribute('style', "font-size: 1.4em;");
               document.getElementById("end-date-label").classList.add("pt-3");
               CreateElement("input", "end-date", "2023-11-01", "end-date-div").classList.add("form-control");
               document.getElementById("end-date").setAttribute('type', "date");
               document.getElementById("end-date").value = "2023-11-30";
               document.getElementById("end-date").setAttribute('onchange', "OnChangeDates()");
          }
          OnChangeDates();
     }
}

PeriodChanged();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AddNewOrderAdditionalToDB">AddNewOrderAdditionalToDB</a></li><li><a href="global.html#AddNewOrderToDB">AddNewOrderToDB</a></li><li><a href="global.html#AddNew%25D0%25A1lientToDB">AddNewСlientToDB</a></li><li><a href="global.html#CloseConnectionToDB">CloseConnectionToDB</a></li><li><a href="global.html#ConnectToDB">ConnectToDB</a></li><li><a href="global.html#CreateElement">CreateElement</a></li><li><a href="global.html#FillInCarsStatisticsTable">FillInCarsStatisticsTable</a></li><li><a href="global.html#FillInClientsStatisticsTable">FillInClientsStatisticsTable</a></li><li><a href="global.html#FillInEmployeesTable">FillInEmployeesTable</a></li><li><a href="global.html#FillInTables">FillInTables</a></li><li><a href="global.html#FillInTheTable">FillInTheTable</a></li><li><a href="global.html#OnChangeDates">OnChangeDates</a></li><li><a href="global.html#PeriodChanged">PeriodChanged</a></li><li><a href="global.html#addCar">addCar</a></li><li><a href="global.html#addOptions">addOptions</a></li><li><a href="global.html#buttonCheckoutCloseOnClick">buttonCheckoutCloseOnClick</a></li><li><a href="global.html#buttonCheckoutOnClick">buttonCheckoutOnClick</a></li><li><a href="global.html#buttonCheckoutSubmitOnClickAndWriteOrderToDB">buttonCheckoutSubmitOnClickAndWriteOrderToDB</a></li><li><a href="global.html#calculateThePrice">calculateThePrice</a></li><li><a href="global.html#cartIsEmpty">cartIsEmpty</a></li><li><a href="global.html#changeRenderCart">changeRenderCart</a></li><li><a href="global.html#changeTotalPrice">changeTotalPrice</a></li><li><a href="global.html#clearData">clearData</a></li><li><a href="global.html#deleteFunction">deleteFunction</a></li><li><a href="global.html#formatDate">formatDate</a></li><li><a href="global.html#getEmployeeIdFromDB">getEmployeeIdFromDB</a></li><li><a href="global.html#get%25D0%25A1lientIdFromDB">getСlientIdFromDB</a></li><li><a href="global.html#isEmpty">isEmpty</a></li><li><a href="global.html#minusFunction">minusFunction</a></li><li><a href="global.html#plusFunction">plusFunction</a></li><li><a href="global.html#renderCart">renderCart</a></li><li><a href="global.html#saveData">saveData</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Mon Nov 27 2023 11:35:54 GMT+0200 (Восточная Европа, стандартное время)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
